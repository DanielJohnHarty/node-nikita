// Generated by CoffeeScript 1.8.0
var execute, misc, remove, wrap;

module.exports = function(goptions, options, callback) {
  return wrap(arguments, function(options, next) {
    var do_delprinc, do_end, do_keytab, modified;
    if (!options.principal) {
      return next(new Error('Property principal is required'));
    }
    modified = false;
    do_delprinc = function() {
      return execute({
        cmd: misc.kadmin(options, "delprinc -force " + options.principal),
        ssh: options.ssh,
        log: options.log,
        stdout: options.stdout,
        stderr: options.stderr
      }, function(err, _, stdout) {
        if (err) {
          return next(err);
        }
        if (-1 === stdout.indexOf('does not exist')) {
          modified = true;
        }
        return do_keytab();
      });
    };
    do_keytab = function() {
      if (!options.keytab) {
        return do_end();
      }
      return remove({
        ssh: options.ssh,
        destination: options.keytab
      }, function(err, removed) {
        if (err) {
          return next(err);
        }
        if (removed) {
          modified++;
        }
        return do_end();
      });
    };
    do_end = function() {
      return next(null, modified);
    };
    return do_delprinc();
  });
};

misc = require('./misc');

wrap = require('./misc/wrap');

execute = require('./execute');

remove = require('./remove');
