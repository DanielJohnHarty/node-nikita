// Generated by CoffeeScript 1.8.0
var fs, misc, wrap;

module.exports = function(goptions, options, callback) {
  return wrap(arguments, function(options, next) {
    var mode, ssh;
    ssh = options.ssh, mode = options.mode;
    if (!options.destination) {
      return next(new Error("Missing destination: " + options.destination));
    }
    if (typeof options.log === "function") {
      options.log("Mecano `chmod`: stat \"" + options.destination + "\"");
    }
    return fs.stat(ssh, options.destination, function(err, stat) {
      if (err) {
        return next(err);
      }
      if (misc.mode.compare(stat.mode, mode)) {
        return next();
      }
      if (typeof options.log === "function") {
        options.log("Mecano `chmod`: change mode form " + stat.mode + " to " + mode);
      }
      return fs.chmod(ssh, options.destination, mode, function(err) {
        return next(err, true);
      });
    });
  });
};

fs = require('ssh2-fs');

misc = require('./misc');

wrap = require('./misc/wrap');
