// Generated by CoffeeScript 2.3.1
// # `nikita.system.info.system(options, [callback])`

// Expose system information. Internally, it uses the command `uname` to retrieve
// information.

// ## Options

// There are no user option to this action.

// ## Callback

// The following properties are available:

// - `system.kernel_name` (string)   
//   The kernel name.
// - `system.nodename` (string)   
//   The network node hostname.
// - `system.kernel_release` (string)   
//   The kernel release.
// - `system.kernel_version` (string)   
//   The kernel version.
// - `system.properties` (string)   
//   The processor type (non-portable).
// - `system.operating_system` (string)   
//   The operating system.

// ## Todo

// There are more properties exposed by `uname` such as the machine hardware name
// and the hardware platform. Those properties shall be exposed.

// We shall explain what "non-portable" means.

// ## Example

// ```js
// require('nikita')
// .system.info.system(function(err, {system}){
//   if(err) throw err;
//   console.info('Kernel name:', system.kernel_name)
//   console.info('Node name:', system.nodename)
//   console.info('Kernel release:', system.kernel_release)
//   console.info('Kernel version:', system.kernel_version)
//   console.info('Processor:', system.processor)
//   console.info('Operating system:', system.operating_system)
// })
// ```

// ## Source Code
module.exports = function(options, callback) {
  // Note, kernel version is executed separately because it contains spaces.
  return this.system.execute({
    header: 'Server',
    cmd: 'uname -snrmo\nuname -v'
  }, function(err, {stdout}) {
    var cmd1, cmd2, match;
    if (err) {
      throw err;
    }
    [cmd1, cmd2] = stdout.split(/\n/);
    // Linux hadoop1 2.6.32-279.el6.x86_64 #1 SMP Fri Jun 22 12:19:21 UTC 2012 x86_64 x86_64 x86_64 GNU/Linux
    match = /([^ ]+) ([^ ]+) ([^ ]+) ([^ ]+) ([^ ]+)/.exec(cmd1);
    return callback(null, {
      system: {
        kernel_name: match[1],
        kernel_release: match[3],
        kernel_version: cmd2,
        nodename: match[2],
        operating_system: match[5],
        processor: match[4]
      }
    });
  });
};
