// Generated by CoffeeScript 2.0.3
// # `nikita.system.mod`

// Load a kernel module.

// ## Options

// *   `name` (string)
//     Name of the module.
// *   `target` (string)   
//     Path of the file to write the module, relative to "/etc/modules-load.d"
//     unless absolute, default to "/etc/modules-load.d/{options.name}.conf".

// ## Example

// require('nikita').system.mod({
//   name: 'vboxpci'
// })

// todo: persist accross reboot `echo 'module_name' >> /etc/modules-load.d/sth.conf`
var path;

module.exports = function(options) {
  if (options.argument != null) {
    options.name = options.argument;
  }
  if (options.target == null) {
    options.target = `${options.name}.conf`;
  }
  options.target = path.resolve('/etc/modules-load.d', options.target);
  if (!options.name) {
    throw Error("Required Option: name");
  }
  this.system.execute({
    cmd: `lsmod | grep ${options.name} && exit 3\nsudo modprobe ${options.name}`,
    code_skipped: 3
  });
  return this.file({
    target: options.target,
    match: /#{options.name}/,
    replace: options.name,
    append: true,
    eof: true
  });
};

// ## Dependencies
path = require('path');
