// Generated by CoffeeScript 1.9.1
var docker, path, util;

module.exports = function(options, callback) {
  if (options.image == null) {
    return callback(Error('Missing image parameter'));
  }
  if ((options.content != null) && (options.dockerfile != null)) {
    return callback(Error('Can not build from Dockerfile and content'));
  }
  return docker.get_provider(options, (function(_this) {
    return function(err, provider) {
      var cmd, exec_opts, i, j, k, len, len1, opt, ref, ref1;
      if (err) {
        return callback(err);
      }
      options.provider = provider;
      cmd = docker.prepare_cmd(provider, options.machine);
      if (util.isError(cmd)) {
        return callback(cmd);
      }
      cmd += 'docker login';
      ref = ['email', 'user', 'password'];
      for (i = 0, len = ref.length; i < len; i++) {
        opt = ref[i];
        if (options[opt] != null) {
          cmd += " -" + (opt.charAt(0)) + " " + options[opt];
        }
      }
      if (options.registry != null) {
        cmd += " \"" + options.registry + "\"";
      }
      exec_opts = {
        cmd: cmd
      };
      ref1 = ['ssh', 'log', 'stdout', 'stderr', 'cwd', 'code', 'code_skipped'];
      for (j = 0, len1 = ref1.length; j < len1; j++) {
        k = ref1[j];
        if (options[k] != null) {
          exec_opts[k] = options[k];
        }
      }
      return _this.execute(exec_opts, function(err, executed, stdout, stderr) {
        return callback(err, executed, stdout, stderr);
      });
    };
  })(this));
};

docker = require('./commons');

path = require('path');

util = require('util');
