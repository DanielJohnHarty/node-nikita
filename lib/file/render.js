// Generated by CoffeeScript 1.12.4
var fs, path;

module.exports = function(options) {
  options.log({
    message: "Entering file.render",
    level: 'DEBUG',
    module: 'nikita/lib/file/render'
  });
  if (!(options.source || options.content)) {
    throw Error('Missing source or content');
  }
  if (!options.target) {
    throw Error('Missing target');
  }
  this.call(function(_, callback) {
    var ssh;
    if (!options.source) {
      return callback();
    }
    ssh = options.local ? null : options.ssh;
    return fs.exists(ssh, options.source, function(err, exists) {
      if (!exists) {
        return callback(Error("Invalid source, got " + (JSON.stringify(options.source))));
      }
      return fs.readFile(ssh, options.source, 'utf8', function(err, content) {
        if (!err) {
          options.content = content;
        }
        return callback(err);
      });
    });
  });
  return this.call(function() {
    var extension;
    if (!options.engine && options.source) {
      extension = path.extname(options.source);
      switch (extension) {
        case '.j2':
          options.engine = 'nunjunks';
          break;
        case '.eco':
          options.engine = 'eco';
      }
    }
    options.source = null;
    options.header = null;
    return this.file(options);
  });
};

fs = require('ssh2-fs');

path = require('path');
