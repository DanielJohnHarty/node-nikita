// Generated by CoffeeScript 1.10.0
var path, protocols_ftp, protocols_http, url,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

module.exports = function(options, callback) {
  var cmd, fail, k, ref, u;
  if (!options.source) {
    return callback(Error("Missing source: '" + options.source + "'"));
  }
  if (!(options.cache_file || options.cache_dir)) {
    return callback(Error("Missing one of 'cache_file' or 'cache_dir' option"));
  }
  if (options.cache_file == null) {
    options.cache_file = path.basename(options.source);
  }
  options.cache_file = path.resolve(options.cache_dir, options.cache_file);
  u = url.parse(options.source);
  if (ref = u.protocol, indexOf.call(protocols_http, ref) >= 0) {
    fail = options.fail ? "--fail" : '';
    k = u.protocol === 'https:' ? '-k' : '';
    cmd = "curl " + fail + " " + k + " -s " + options.source + " -o " + options.cache_file;
    if (options.proxy) {
      cmd += " -x " + options.proxy;
    }
    this.mkdir(path.dirname(options.cache_file));
    this.execute({
      cmd: cmd,
      not_if_exists: options.cache_file
    });
    return this.then(function(err, status) {
      return callback(err, status, options.cache_file);
    });
  }
};

module.exports.protocols_http = protocols_http = ['http:', 'https:'];

module.exports.protocols_ftp = protocols_ftp = ['ftp:', 'ftps:'];

path = require('path');

url = require('url');
