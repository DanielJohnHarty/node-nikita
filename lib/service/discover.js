// Generated by CoffeeScript 1.11.1
module.exports = function(options, callback) {
  var detected, loader;
  detected = false;
  loader = null;
  if (options.strict == null) {
    options.strict = false;
  }
  if (options.shy == null) {
    options.shy = true;
  }
  if (options.cache == null) {
    options.cache = true;
  }
  this.system.execute({
    shy: options.shy,
    unless: options.store['nikita:service:loader'] != null,
    cmd: "if which systemctl >/dev/null; then exit 1; fi ;\nif which service >/dev/null; then exit 2; fi ;\nexit 3 ;",
    code: [1, 2],
    shy: true
  }, function(err, status, stdout, stderr, signal) {
    if ((err != null ? err.code : void 0) === 3 && options.strict) {
      throw Error("Undetected Operating System Loader");
    }
    if (options.store == null) {
      options.store = {};
    }
    loader = (function() {
      switch (signal) {
        case 1:
          return 'systemctl';
        case 2:
          return 'service';
      }
    })();
    if (options.cache) {
      return options.store['nikita:service:loader'] = options.loader;
    }
  });
  return this.then(function(err, status) {
    if (options.cache && (loader == null)) {
      loader = options.store['nikita:service:loader'] != null;
    }
    return callback(err, status, loader);
  });
};
