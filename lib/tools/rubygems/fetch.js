// Generated by CoffeeScript 1.12.5
var path;

module.exports = function(options, callback) {
  options.log({
    message: "Entering rubygem.fetch",
    level: 'DEBUG',
    module: 'nikita/lib/tools/rubygem/fetch'
  });
  if (options.gem_bin == null) {
    options.gem_bin = 'gem';
  }
  this.system.execute({
    unless: options.version,
    cmd: "gem specification json version -r | grep -v '^\\-\\-\\-' | sed 's/.*: \\(.*\\)$/\\1/'",
    cwd: options.cwd,
    shy: true
  }, function(err, status, stdout) {
    if (err) {
      throw err;
    }
    if (status) {
      options.version = stdout.trim();
    }
    return options.target = options.name + "-" + options.version + ".gem";
  });
  this.call(function() {
    return this.system.execute({
      cmd: options.gem_bin + " fetch " + options.name + " -v " + options.version,
      cwd: options.cwd
    });
  });
  return this.then(function(err, status) {
    return callback(err, status, options.target, path.resolve(options.cwd, options.target));
  });
};

path = require('path');
