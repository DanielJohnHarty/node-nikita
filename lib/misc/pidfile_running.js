// Generated by CoffeeScript 2.1.1
// # `pidfile_running(ssh, pidfile, callback)`

// Check if the pid (Process Id) stored inside a file match a running process. Any
// file referencing a dead process will be removed.

// The callback is called with an error and a boolean indicating if the process is
// running.

// ```js
// pidfile_running ssh, pidfile, function(err, running){
//   console.log(err ? err.message : 'Running: '+running);
// }
// ```
var exec;

module.exports = function(ssh, pidfile, callback) {
  var child;
  if (arguments.length === 4) {
    throw Error('Argument "options" removed');
  }
  child = exec(ssh, `if [ ! -f '${pidfile}' ]; then exit 1; fi\nif ! kill -s 0 \`cat '${pidfile}'\`; then\n  rm '${pidfile}';\n  exit 2;\nfi`);
  child.on('error', callback);
  return child.on('exit', function(code) {
    return callback(null, code === 0);
  });
};

// ## Dependencies
exec = require('ssh2-exec');
