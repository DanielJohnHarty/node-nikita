// Generated by CoffeeScript 1.8.0
var fs, wrap;

module.exports = function(goptions, options, callback) {
  return wrap(arguments, function(options, next) {
    var gid, ssh, uid;
    ssh = options.ssh, uid = options.uid, gid = options.gid;
    if (!options.destination) {
      return next(new Error("Missing destination: " + options.destination));
    }
    if (!((uid != null) && (gid != null))) {
      return next();
    }
    if (typeof options.log === "function") {
      options.log("Mecano `chown`: stat " + options.destination);
    }
    return fs.stat(ssh, options.destination, function(err, stat) {
      if (err) {
        return next(err);
      }
      if (stat.uid === uid && stat.gid === gid) {
        return next();
      }
      if (stat.uid !== uid) {
        if (typeof options.log === "function") {
          options.log("Mecano `chown`: change uid from " + stat.uid + " to " + uid);
        }
      }
      if (stat.gid !== gid) {
        if (typeof options.log === "function") {
          options.log("Mecano `chown`: change gid from " + stat.gid + " to " + gid);
        }
      }
      return fs.chown(ssh, options.destination, uid, gid, function(err) {
        return next(err, true);
      });
    });
  });
};

fs = require('ssh2-fs');

wrap = require('./misc/wrap');
