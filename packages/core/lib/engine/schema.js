// Generated by CoffeeScript 2.5.0
var Ajv, ajv_keywords;

Ajv = require('ajv');

ajv_keywords = require('ajv-keywords');

module.exports = function() {
  var ajv;
  ajv = new Ajv({
    $data: true,
    allErrors: true,
    useDefaults: true,
    // extendRefs: 'ignore'
    extendRefs: true
  });
  // coerceTypes: true
  // loadSchema: (uri) ->
  //   new Promise (accept, reject) ->
  //     uri = if /^@nikitajs\/core/.test(middleware.handler)
  //     then require "../#{middleware.handler.substr(14)}"
  //     else require.main.require uri
  //     result = uri
  ajv_keywords(ajv);
  return {
    add: function(schema, name) {
      if (!schema) {
        return;
      }
      return ajv.addSchema(schema, name);
    },
    validate: function(data, schema) {
      var valid, validate;
      // validate = ajv.compileAsync schema
      // valid = await validate data
      validate = ajv.compile(schema);
      valid = validate(data);
      if (validate.errors) {
        return validate.errors.map(function(error) {
          return Error(ajv.errorsText([error]));
        });
      } else {
        return [];
      }
    },
    list: function() {
      return {
        schemas: ajv._schemas,
        refs: ajv._refs,
        fragments: ajv._fragments
      };
    }
  };
};
