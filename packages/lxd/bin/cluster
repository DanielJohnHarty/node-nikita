#!/usr/bin/env node

const nikita = require('nikita')

const key = `${__dirname}/../src/cluster/assets/.vagrant/machines/default/virtualbox/private_key`
nikita({
  debug: false
})
.system.execute({
  unless_exec: 'vagrant plugin list | egrep \'^vagrant-vbguest \'',
  cmd: `
  vagrant plugin install vagrant-vbguest
  `
})
.system.execute({
  cwd: `${__dirname}/../src/cluster/assets`,
  cmd: `
  vagrant up
  `
})
.system.execute({
  cmd: `
  lxc remote add nikita 127.0.0.1:8443 --accept-certificate --password secret
  lxc remote switch nikita
  `
})
.system.execute({
  cwd: `${__dirname}/../src/cluster/assets`,
  cmd: `
  ssh -i ${key} -qtt -p 2222 vagrant@127.0.0.1 -- "cd /nikita && bash"
  `,
  stdin: process.stdin,
  stdout: process.stdout,
  stderr: process.stderr
})
